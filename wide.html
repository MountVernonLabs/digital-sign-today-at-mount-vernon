<!DOCTYPE html>
<html>
	<head>
		<style>
				body{
					margin:0;
					overflow:hidden;
				}
				.wrapper{
					
					background-color:#000;
					color:#fff;
				}
		</style>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	</head>

	<body>

		<div class="wrapper">
			<h1 id="heading"></h1>
			<h3 id="time"></h3>
		</div>
		<script>
			// Get locations
			var mvloc;
			$.getJSON("http://www.mountvernon.org/site/api/locations", function(jsonloc){
				mvloc = jsonloc;
			});
	
			// Get today's events
			$.getJSON("http://www.mountvernon.org/site/api/events-today",
				function(data){
					$.each(data, function(i, item) {
						// Need to eliminate duplicates
						// Need to add class to each item
						// Need to paginate results
						// Need to make this a recurring function run every X minute instead of just on load
						// Need to cache page results in the event of internet loss
						
						if (item.start_time !== null) {
							var start_time = item.start_time;
						} else {
							var start_time = "All Day";
						}
						$(".wrapper").append("<p>"+start_time+": "+item.title+"</p>");
						var title = item.title;
						if (item.start_time !== null) {
							$.each(JSON.parse(item.extra_times), function(i, item) {
								$(".wrapper").append("<p>"+item.start_time+": "+title+"</p>");
							});
						}
					});
				});
				
				// Get date and monitor for changes
				setInterval(function(){ 
					var d = new Date();
					var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
					var new_date_title = months[d.getMonth()]+" "+d.getDate();
					if ($("#heading").text() != new_date_title) {
						// This will detect if it's a new day, reset items and re-run functions
						$("#heading").text(new_date_title);
					}
				}, 3000);
	
				// Clock
				function startTime() {
					var today = new Date();
					var h = today.getHours();
					var m = today.getMinutes();
					var ampm = h >= 12 ? 'PM' : 'AM';
					h = h % 12;
					h = h ? h : 12;
					m = checkTime(m);
					$("#time").text(h + ":" + m + " " + ampm);
					var t = setTimeout(startTime, 500);
				}
				function checkTime(i) {
					if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
					return i;
				}			
				startTime();
				
		</script>
	</body>
</html>
